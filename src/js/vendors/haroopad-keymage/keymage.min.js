(function(e,t){e(function(){function e(e){var t=e.split("-"),r=t[t.length-1],n={code:m[r]};if(!n.code)throw'Unknown key "'+r+'" in keystring "'+e+'"';for(var i,o=0;t.length-1>o;o++){if(r=t[o],i=d[r],!i)throw'Unknown modifier "'+r+'" in keystring "'+e+'"';n[i]=!0}return n}function r(e){for(var t="",r=0;h.length>r;r++)e[h[r]]&&(t+=h[r]+"-");return t+=g[e.code]}function n(t){for(var n=[],i=t.split(" "),o=0;i.length>o;o++){var a=e(i[o]);a=r(a),n.push(a)}return n.original=t,n}function i(e){for(var t={code:e.keyCode},n=0;f.length>n;n++){var i=f[n];e[i]&&(t[i.slice(0,i.length-3)]=!0)}return r(t)}function o(e,t){for(var r=0;t.length>r;r++){var n=t[r];if(n&&(e=e[n]),!e)break}return e}function a(e){if(!~p.indexOf(e.keyCode)&&!e.altGraphKey){var r=k.slice();r.push(i(e));for(var n,a,s,l=b.split("."),c=l.length;c>=0;c--)if(a=o(x,l.slice(0,c))){n=!0;for(var u=0;r.length>u;u++){if(s=r[u],!a[s]){n=!1;break}a=a[s]}if(n)break}var f=l.slice(0,c).join("."),d=a.preventDefault;if(n&&!a.handlers)return k=r,d&&e.preventDefault(),t;if(n)for(c=0;a.handlers.length>c;c++){var h=a.handlers[c],m=h._keymage,g=h.call(m.context,e,{shortcut:m.original,scope:b,definitionScope:f});(g===!1||d)&&e.preventDefault()}k=[]}}function s(e,t,r){var n=e.split("."),i=x;n=n.concat(t);for(var o=0,a=n.length;a>o;o++){var s=n[o];if(s&&(i=i[s]||(i[s]={}),r._keymage.preventDefault&&(i.preventDefault=!0),o===a-1)){var l=i.handlers||(i.handlers=[]);l.push(r)}}}function l(e,r,i,o){if(r===t&&i===t)return function(t,r){return l(e,t,r)};"function"==typeof r&&(o=i,i=r,r=e,e="");var a=n(r);i._keymage=o||{},i._keymage.original=r,s(e,a,i)}var c,u="1.0.1",f=["shiftKey","ctrlKey","altKey","metaKey"],d={shift:"shift",ctrl:"ctrl",control:"ctrl",alt:"alt",option:"alt",win:"meta",cmd:"meta","super":"meta",meta:"meta",defmod:~navigator.userAgent.indexOf("Mac OS X")?"meta":"ctrl"},h=["shift","ctrl","alt","meta"],p=[16,17,18,91],m={backspace:8,tab:9,enter:13,"return":13,pause:19,caps:20,capslock:20,escape:27,esc:27,space:32,pgup:33,pageup:33,pgdown:34,pagedown:34,end:35,home:36,ins:45,insert:45,del:46,"delete":46,left:37,up:38,right:39,down:40,"*":106,"+":107,plus:107,"-":109,minus:109,";":186,"=":187,",":188,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(c=0;10>c;c++)m["num-"+c]=c+95;for(c=0;10>c;c++)m[""+c]=c+48;for(c=1;25>c;c++)m["f"+c]=c+111;for(c=65;91>c;c++)m[String.fromCharCode(c).toLowerCase()]=c;var g={};for(var v in m){var y=m[v];(!g[y]||g[y].length<v.length)&&(g[y]=v)}var b="",x={},k=[];return l.parse=e,l.stringify=r,l.bindings=x,l.setScope=function(e){b=e?e:""},l.getScope=function(){return b},l.pushScope=function(e){return b=(b?b+".":"")+e},l.popScope=function(e){var t;return e?(b=b.replace(RegExp("(^|\\.)"+e+"(\\.|$).*"),""),e):(t=b.lastIndexOf("."),e=b.slice(t+1),b=-1==t?"":b.slice(0,t),e)},l.version=u,window.addEventListener("keydown",a,!1),l})})("undefined"!=typeof define?define:function(e){window.keymage=e()});